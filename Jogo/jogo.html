<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game - Part 10</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 0 },
            debug: false
        }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

var player;
var cars;
var timerEvent;
var score = 0;
var scoreText;

var game = new Phaser.Game(config);

function preload() {
  this.load.spritesheet('carroplayer', 'assets/carro1.jpg', { frameWidth: 296, frameHeight: 169 });
  this.load.spritesheet('carroinimigo', 'assets/carro2.jpg', { frameWidth: 291, frameHeight: 176 });
  this.load.image('sky', 'assets/sky.png');
}



function create ()
{
    // Adicionar o fundo do jogo
    this.add.image(400, 300, 'sky');

    // Adicionar o carro do jogador
    player = this.physics.add.sprite(400, 500, 'carroplayer');
    player.setCollideWorldBounds(true);
    player.setScale(0.2);

    player.x = 50;
    player.y = 550;

    // Adicionar os carros inimigos
    cars = this.physics.add.group();

    // Adicionar o texto da pontuação
    scoreText = this.add.text(16, 16, 'score: 0', { fontSize: '32px', fill: '#000' });

    // Adicionar as teclas de controle
    cursors = this.input.keyboard.createCursorKeys();

    // Adicionar o evento de tempo para criar novos carros aleatoriamente
    timerEvent = this.time.addEvent({
        delay: 1000,
        callback: createCar,
        callbackScope: this,
        loop: true
    });
}

function update ()
{

    // Movimentar o carro do jogador com as teclas de controle
    if (cursors.up.isDown) {
        player.setVelocityY(-400)
    } else if (cursors.down.isDown) {
        player.setVelocityY(400)
    } else if (cursors.right.isDown) {
        player.setVelocityX(350)
    } else if (cursors.left.isDown) {
        player.setVelocityX(-350)
    } else {
        player.setVelocityY(0);
    }

    // Verificar colisões entre o carro do jogador e os carros inimigos
    this.physics.add.collider(player, cars, gameOver, null, this);

    // Atualizar a pontuação
    scoreText.setText('Score: ' + score);
    // Acelerar os carros inimigos à medida que o jogo avança
    cars.children.iterate(function (child) {
        child.setVelocityY(200 + (score / 10));
    });
}
function createCar() {
    // Escolher uma via aleatória para adicionar o carro inimigo
    var lane = Phaser.Math.Between(1, 6);
    var y = (lane * 100) - 50;
    // Adicionar o carro inimigo na posição aleatória
    car = cars.create(y, 400, 'carroinimigo');
    car.setVelocityY(200 + (score / 10));

    car.setScale(0.2);
    car.setCollideWorldBounds(true);
    car.setBounce(1);

    // Adicionar uma animação para o carro inimigo
    this.anims.create({
        key: 'move',
        frames: this.anims.generateFrameNumbers('carroinimigo', { start: 0, end: -1 }),
        frameRate: 10,
        repeat: -1
    });
    car.play('move');
    
    car.setCollideWorldBounds(false);

    // Diminuir o delay do evento de tempo a cada vez que um novo carro é criado
    score += 1;
    timerEvent.delay = timerEvent.delay - score * 0.99999999;
}



    function gameOver() {
    // Parar o evento de tempo
    timerEvent.remove(false);
    // Mostrar a mensagem de fim de jogo
    var gameOverText = this.add.text(400, 300, 'Game Over\nFinal Score: ' + score, { fontSize: '64px', fill: '#000' });
    gameOverText.setOrigin(0.5);

    // Parar a movimentação dos carros
    cars.setVelocityY(0);

    // Parar a animação dos carros
    cars.children.iterate(function (child) {
        child.anims.stop();
    });

    // Desativar o movimento do carro do jogador
    player.setVelocityX(0);

    // Desativar as teclas de controle
    cursors.left.destroy();
    cursors.right.destroy();
}
</script>

</body>
</html>