<!doctype html> 
<html lang="en"> 
    <head> 
        <meta charset="UTF-8" />
        <title>Fun Race</title>
        <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
        <style type="text/css">
            canvas {
                display : block;   
                margin : auto;
            }
        </style>
    </head>
    <body>

        <script type="text/javascript">

        var config = {
            type: Phaser.AUTO,
            width: 1080,
            height: 720,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 },
                    debug: false
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        var player;
        var cars;
        var timerEvent;
        var score = 0;
        var gasol = 0;
        var scoreText;
        var game = new Phaser.Game(config);

        function preload() {
            this.load.spritesheet('carroplayer', 'assets/carro1.png', { frameWidth: 169, frameHeight: 296 });
            this.load.spritesheet('carroinimigo', 'assets/carro2.png', { frameWidth: 176, frameHeight: 291 });
            this.load.spritesheet('ambuinimiga', 'assets/ambu.png', { frameWidth: 63, frameHeight: 97 });
            this.load.spritesheet('carroinimigo2', 'assets/azul.png', { frameWidth: 61, frameHeight: 88 });
            this.load.image('estrada', 'assets/sky.png');
        }



        function create ()
        {  
            // Adicionar o fundo do jogo
            this.add.image(540, 360, 'estrada');

            // Adicionar o carro do jogador
            player = this.physics.add.sprite(560, 690, 'carroplayer');
            player.setCollideWorldBounds(true);
            player.setScale(0.25);
            
            // Adicionar os carros inimigos
            cars = this.physics.add.group();

            // Adicionar o texto da pontuação
            scoreText = this.add.text(985, 10, 'score: 0', { fontSize: '20px Calibri bold', fill: 'rgb(0, 51, 102)'});
            gas = this.add.text(985, 680, 'gasolina: 0', { fontSize: '20px Calibri bold', fill: 'rgb(0, 51, 102)'});
            // Adicionar as teclas de controle
            cursors = this.input.keyboard.createCursorKeys();

            // Adicionar o evento de tempo para criar novos carros aleatoriamente
            timerEvent = this.time.addEvent({
                delay: 1000,
                callback: createCar,
                callbackScope: this,
                loop: true
            });

            
            timerEvent2 = this.time.addEvent({
                delay: 1000,
                callback: createCar,
                callbackScope: this,
                loop: true
            });
            
             
        }

        function update ()
        {

            // Movimentar o carro do jogador com as teclas de controle
            if (cursors.up.isDown) {
                player.setVelocityY(-300)
            } else if (cursors.down.isDown) {
                player.setVelocityY(150)
            } else if (cursors.right.isDown) {
                player.setVelocityX(225)
            } else if (cursors.left.isDown) {
                player.setVelocityX(-225)
            } else {
                player.setVelocityY(-50);
                player.setVelocityX(0);
            }

            if (player.x < 200) {
                player.x = 200;
            } else if (player.x > 900) {
                player.x = 900;
            }
            // Verificar colisões entre o carro do jogador e os carros inimigos
            this.physics.add.collider(player, cars, gameOver, null, this);

            // Atualizar a pontuação
            scoreText.setText('Km: ' + score);
            gas.setText('Gas: ' + gasol)
            // Acelerar os carros inimigos à medida que o jogo avança
            cars.children.iterate(function (child) {
                child.setVelocityY(200 + (score / 10));
            });
            
           
            

        }
        function createCar() {
            // Escolher uma via aleatória para adicionar o carro inimigo
            var lane = Phaser.Math.Between(1, 6);
            var c = Phaser.Math.Between(1, 10);
            var y;
            //252 360 486 612 738 846
            switch (lane){
                case 1:
                    y=252;  
                    break;
                case 2:
                    y=360;
                    break;
                case 3:
                    y=486;
                    break;
                case 4:
                    y=612;
                    break;
                case 5:
                    y=738;
                    break;
                case 6:
                    y=846;
                    break;
                
            }        

            
            var v;
            // Adicionar o carro inimigo na posição aleatória
            if (c==1){
                car = cars.create(y, 0, 'ambuinimiga');
                car.setScale(0.8);
                v = Phaser.Math.Between(50, 90);
                car.setVelocityY(v - (score / 10));
            } else if (c>1 && c<6) {
                car = cars.create(y, 0, 'carroinimigo');
                car.setScale(0.25);
                v = Phaser.Math.Between(80, 200);
                car.setVelocityY(v - (score / 10));
            } else {
                car = cars.create(y, 0, 'carroinimigo2');
                car.setScale(0.8);
                v = Phaser.Math.Between(80, 200);
                car.setVelocityY(v - (score / 10));
            }

            
            car.setCollideWorldBounds(true);
            car.setBounce(1);

            // Adicionar uma animação para o carro inimigo
            this.anims.create({
                key: 'move2',
                frames: this.anims.generateFrameNumbers('carroinimigo', { start: 0, end: -1 }),
                frameRate: 30,
                repeat: -1
            });
            this.anims.create({
                key: 'move3',
                frames: this.anims.generateFrameNumbers('carroinimigo2', { start: 0, end: -1 }),
                frameRate: 30,
                repeat: -1
            });
            this.anims.create({
                key: 'move1',
                frames: this.anims.generateFrameNumbers('ambuinimiga', { start: 0, end: -1 }),
                frameRate: 30,
                repeat: -1
            });

            if (lane === 1 || lane === 2 || lane === 3) {
                car.setFlipX(true);
            }
            
            if(c==1){  
                car.play('move1');
            }else if (c>1 && c<6) {
                car.play('move2');
            }else {
                car.play('move3');
            }
            
            car.setCollideWorldBounds(false);
 
            // Diminuir o delay do evento de tempo a cada vez que um novo carro é criado
            score += 0.5;
            if(score > 60){
                timerEvent.delay == 500;
            }
            else{
            timerEvent.delay = timerEvent.delay - 0.1;
            }
            
            if (score > 30){
                timerEvent2.delay = 1200;
            }
            else{
                timerEvent2.delay= 10000000;
            }

            
        }



            function gameOver() {
            // Parar o evento de tempo
            timerEvent.remove(false);
            // Mostrar a mensagem de fim de jogo
            var gameOverText = this.add.text(400, 300, 'Game Over\nFinal Score: ' + score, { fontSize: '64px', fill: '#000' });
            gameOverText.setOrigin(0.5);

            // Parar a movimentação dos carros
            cars.setVelocityY(0);

            // Parar a animação dos carros
            cars.children.iterate(function (child) {
                child.anims.stop();
            });

            // Desativar o movimento do carro do jogador
            player.setVelocityX(0);

            // Desativar as teclas de controle
            cursors.left.destroy();
            cursors.right.destroy();
        }
        </script>

    </body>
</html>